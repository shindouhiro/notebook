# Vue 3 æºç å®æˆ˜ç¬”è®°

> ğŸ¯ **ç›®æ ‡**ï¼šæ·±å…¥ç†è§£ Vue 3 æ ¸å¿ƒæºç ï¼ŒæŒæ¡å“åº”å¼åŸç†ã€è™šæ‹Ÿ DOMã€ç¼–è¯‘å™¨ç­‰æ ¸å¿ƒæ¨¡å—
> ğŸ“… **åˆ›å»ºæ—¶é—´**ï¼š2024-12-24

---

## ğŸ“š æºç å­¦ä¹ è·¯å¾„

```mermaid
graph TD
    A[Vue 3 æºç å…¥é—¨] --> B[å“åº”å¼ç³»ç»Ÿ]
    B --> C[è™šæ‹Ÿ DOM]
    C --> D[Diff ç®—æ³•]
    D --> E[ç»„ä»¶ç³»ç»Ÿ]
    E --> F[ç¼–è¯‘å™¨åŸç†]
    F --> G[è¿è¡Œæ—¶æ ¸å¿ƒ]
```

---

## ğŸ—ï¸ Vue 3 æºç ç»“æ„

Vue 3 é‡‡ç”¨ **Monorepo** æ¶æ„ï¼Œä½¿ç”¨ pnpm workspace ç®¡ç†å¤šä¸ªåŒ…ï¼š

```
packages/
â”œâ”€â”€ reactivity/          # å“åº”å¼ç³»ç»Ÿ (ç‹¬ç«‹å¯ç”¨)
â”œâ”€â”€ runtime-core/        # è¿è¡Œæ—¶æ ¸å¿ƒ (å¹³å°æ— å…³)
â”œâ”€â”€ runtime-dom/         # æµè§ˆå™¨è¿è¡Œæ—¶
â”œâ”€â”€ compiler-core/       # ç¼–è¯‘å™¨æ ¸å¿ƒ (å¹³å°æ— å…³)
â”œâ”€â”€ compiler-dom/        # æµè§ˆå™¨ç¼–è¯‘å™¨
â”œâ”€â”€ compiler-sfc/        # å•æ–‡ä»¶ç»„ä»¶ç¼–è¯‘å™¨
â”œâ”€â”€ vue/                 # å®Œæ•´æ„å»ºå…¥å£
â”œâ”€â”€ shared/              # å…±äº«å·¥å…·å‡½æ•°
â””â”€â”€ ...
```

---

## ğŸ“– æ ¸å¿ƒæ¨¡å—ç¬”è®°

### å“åº”å¼ç³»ç»Ÿ `@vue/reactivity`

| ç¬”è®° | å†…å®¹ | éš¾åº¦ |
|------|------|------|
| [[å“åº”å¼åŸç†-reactive]] | reactive/ref å®ç°åŸç† | â­â­â­ |
| [[å“åº”å¼åŸç†-effect]] | effect å‰¯ä½œç”¨å‡½æ•° | â­â­â­ |
| [[å“åº”å¼åŸç†-computed]] | computed è®¡ç®—å±æ€§ | â­â­â­ |
| [[å“åº”å¼åŸç†-watch]] | watch/watchEffect | â­â­â­ |

### è™šæ‹Ÿ DOM ä¸ Diff

| ç¬”è®° | å†…å®¹ | éš¾åº¦ |
|------|------|------|
| [[è™šæ‹ŸDOM-VNode]] | VNode èŠ‚ç‚¹ç»“æ„ | â­â­â­ |
| [[Diffç®—æ³•è¯¦è§£]] | å¿«é€Ÿ Diff ç®—æ³• | â­â­â­â­ |
| [[Rendereræ¸²æŸ“å™¨]] | æ¸²æŸ“å™¨å®ç° | â­â­â­â­ |

### ç»„ä»¶ç³»ç»Ÿ

| ç¬”è®° | å†…å®¹ | éš¾åº¦ |
|------|------|------|
| [[ç»„ä»¶å®ä¾‹åŒ–æµç¨‹]] | ç»„ä»¶æŒ‚è½½è¿‡ç¨‹ | â­â­â­ |
| [[ç”Ÿå‘½å‘¨æœŸå®ç°]] | ç”Ÿå‘½å‘¨æœŸé’©å­åŸç† | â­â­â­ |
| [[Propså’ŒEmit]] | ç»„ä»¶é€šä¿¡æœºåˆ¶ | â­â­ |

### ç¼–è¯‘å™¨ `@vue/compiler-core`

| ç¬”è®° | å†…å®¹ | éš¾åº¦ |
|------|------|------|
| [[æ¨¡æ¿ç¼–è¯‘æµç¨‹]] | Parse â†’ Transform â†’ Generate | â­â­â­â­ |
| [[ASTæŠ½è±¡è¯­æ³•æ ‘]] | æ¨¡æ¿ AST ç»“æ„ | â­â­â­â­ |
| [[ç¼–è¯‘ä¼˜åŒ–ç­–ç•¥]] | é™æ€æå‡ã€è¡¥ä¸æ ‡è®° | â­â­â­â­ |

---

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. å…‹éš†æºç 

```bash
git clone https://github.com/vuejs/core.git vue3-source
cd vue3-source
```

### 2. å®‰è£…ä¾èµ–

```bash
# éœ€è¦ä½¿ç”¨ pnpm
npm install -g pnpm
pnpm install
```

### 3. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm build

# å¼€å‘æ¨¡å¼ (ç›‘å¬å˜åŒ–)
pnpm dev
```

### 4. è°ƒè¯•æºç 

```bash
# åœ¨ packages/vue/examples ä¸‹åˆ›å»ºæµ‹è¯•æ–‡ä»¶
# å¼€å¯ sourceMap è°ƒè¯•
pnpm dev --sourcemap
```

---

## ğŸ” æºç é˜…è¯»æŠ€å·§

### æ¨èé˜…è¯»é¡ºåº

1. **`@vue/shared`** - å…ˆäº†è§£å·¥å…·å‡½æ•°
2. **`@vue/reactivity`** - å“åº”å¼ç³»ç»Ÿ (å¯ç‹¬ç«‹è¿è¡Œ)
3. **`@vue/runtime-core`** - è¿è¡Œæ—¶æ ¸å¿ƒ
4. **`@vue/compiler-core`** - ç¼–è¯‘å™¨æ ¸å¿ƒ

### è°ƒè¯•æŠ€å·§

```javascript
// åœ¨æºç ä¸­æ·»åŠ  debugger
export function reactive(target) {
  debugger // æ–­ç‚¹è°ƒè¯•
  return createReactiveObject(target, ...)
}
```

### ä½¿ç”¨ VSCode è°ƒè¯•

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "chrome",
      "request": "launch",
      "name": "Debug Vue",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}"
    }
  ]
}
```

---

## ğŸ“Š æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ

### å“åº”å¼æ ¸å¿ƒ API

| API | è¯´æ˜ | æºç ä½ç½® |
|-----|------|----------|
| `reactive` | æ·±åº¦å“åº”å¼ä»£ç† | `packages/reactivity/src/reactive.ts` |
| `ref` | å€¼ç±»å‹å“åº”å¼ | `packages/reactivity/src/ref.ts` |
| `effect` | å‰¯ä½œç”¨å‡½æ•° | `packages/reactivity/src/effect.ts` |
| `computed` | è®¡ç®—å±æ€§ | `packages/reactivity/src/computed.ts` |
| `watch` | ç›‘å¬å™¨ | `packages/runtime-core/src/apiWatch.ts` |

### æ¸²æŸ“å™¨æ ¸å¿ƒ

| æ¦‚å¿µ | è¯´æ˜ | æºç ä½ç½® |
|------|------|----------|
| `VNode` | è™šæ‹ŸèŠ‚ç‚¹ | `packages/runtime-core/src/vnode.ts` |
| `patch` | Diff å…¥å£ | `packages/runtime-core/src/renderer.ts` |
| `mount` | æŒ‚è½½é€»è¾‘ | `packages/runtime-core/src/renderer.ts` |
| `update` | æ›´æ–°é€»è¾‘ | `packages/runtime-core/src/renderer.ts` |

---

## ğŸ—ºï¸ ç¬”è®°å¯¼èˆª

```
ğŸ“‚ vue/
â”œâ”€â”€ ğŸ“„ Vue3æºç å®æˆ˜ç¬”è®° (å½“å‰ç¬”è®°)
â”‚
â”œâ”€â”€ ğŸ“‚ å“åº”å¼ç³»ç»Ÿ/
â”‚   â”œâ”€â”€ [[å“åº”å¼åŸç†-reactive]]
â”‚   â”œâ”€â”€ [[å“åº”å¼åŸç†-effect]]
â”‚   â”œâ”€â”€ [[å“åº”å¼åŸç†-computed]]
â”‚   â””â”€â”€ [[å“åº”å¼åŸç†-watch]]
â”‚
â”œâ”€â”€ ğŸ“‚ è™šæ‹ŸDOM/
â”‚   â”œâ”€â”€ [[è™šæ‹ŸDOM-VNode]]
â”‚   â”œâ”€â”€ [[Diffç®—æ³•è¯¦è§£]]
â”‚   â””â”€â”€ [[Rendereræ¸²æŸ“å™¨]]
â”‚
â”œâ”€â”€ ğŸ“‚ ç»„ä»¶ç³»ç»Ÿ/
â”‚   â”œâ”€â”€ [[ç»„ä»¶å®ä¾‹åŒ–æµç¨‹]]
â”‚   â”œâ”€â”€ [[ç”Ÿå‘½å‘¨æœŸå®ç°]]
â”‚   â””â”€â”€ [[Propså’ŒEmit]]
â”‚
â””â”€â”€ ğŸ“‚ ç¼–è¯‘å™¨/
    â”œâ”€â”€ [[æ¨¡æ¿ç¼–è¯‘æµç¨‹]]
    â”œâ”€â”€ [[ASTæŠ½è±¡è¯­æ³•æ ‘]]
    â””â”€â”€ [[ç¼–è¯‘ä¼˜åŒ–ç­–ç•¥]]
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [Vue 3 è®¾è®¡ä¸å®ç° (éœæ˜¥é˜³)](https://www.ituring.com.cn/book/2953)
- [Vue 3 æºç ä»“åº“](https://github.com/vuejs/core)
- [Vue 3 RFC](https://github.com/vuejs/rfcs)

---

## ğŸ·ï¸ æ ‡ç­¾

#Vue3 #æºç åˆ†æ #å‰ç«¯ #å“åº”å¼ #è™šæ‹ŸDOM
