# Go åˆ†é¡µæŸ¥è¯¢å®ç°

> ğŸ”— **å…³è”ç¬”è®°**ï¼š[[ç•™è¨€ç³»ç»Ÿé¡¹ç›®å®æˆ˜]]
> ğŸ“… **åˆ›å»ºæ—¶é—´**ï¼š2024-12-24

---

## ğŸ“– æ¦‚è¿°

åˆ†é¡µæŸ¥è¯¢æ˜¯åç«¯å¼€å‘ä¸­éå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘æ•°æ®ä¼ è¾“é‡ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

---

## ğŸ› ï¸ å®ç°æ­¥éª¤

### 1. å®šä¹‰åˆ†é¡µç»“æ„ä½“

```go
// handlers/pagination.go
package handlers

// Pagination åˆ†é¡µå‚æ•°
type Pagination struct {
	Page     int   `form:"page" json:"page"`           // å½“å‰é¡µç 
	PageSize int   `form:"page_size" json:"page_size"` // æ¯é¡µæ•°é‡
	Total    int64 `json:"total"`                      // æ€»è®°å½•æ•°
}

// GetOffset è®¡ç®—åç§»é‡
func (p *Pagination) GetOffset() int {
	return (p.GetPage() - 1) * p.GetPageSize()
}

// GetPage è·å–å½“å‰é¡µç  (é»˜è®¤ç¬¬1é¡µ)
func (p *Pagination) GetPage() int {
	if p.Page <= 0 {
		p.Page = 1
	}
	return p.Page
}

// GetPageSize è·å–æ¯é¡µæ•°é‡ (é»˜è®¤10æ¡ï¼Œæœ€å¤§100æ¡)
func (p *Pagination) GetPageSize() int {
	if p.PageSize <= 0 {
		p.PageSize = 10
	}
	if p.PageSize > 100 {
		p.PageSize = 100
	}
	return p.PageSize
}
```

### 2. åˆ†é¡µæŸ¥è¯¢å¤„ç†å™¨

```go
// handlers/message.go

// GetMessagesWithPagination åˆ†é¡µè·å–ç•™è¨€
func GetMessagesWithPagination(c *gin.Context) {
	var pagination Pagination
	var messages []models.Message
	
	// ç»‘å®šåˆ†é¡µå‚æ•°
	if err := c.ShouldBindQuery(&pagination); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}
	
	// è·å–æ€»è®°å½•æ•°
	config.DB.Model(&models.Message{}).Count(&pagination.Total)
	
	// åˆ†é¡µæŸ¥è¯¢
	result := config.DB.
		Order("created_at desc").
		Offset(pagination.GetOffset()).
		Limit(pagination.GetPageSize()).
		Find(&messages)
	
	if result.Error != nil {
		c.JSON(http.StatusInternalServerError, gin.H{"error": "æŸ¥è¯¢å¤±è´¥"})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"data": messages,
		"pagination": gin.H{
			"page":      pagination.GetPage(),
			"page_size": pagination.GetPageSize(),
			"total":     pagination.Total,
			"pages":     (pagination.Total + int64(pagination.GetPageSize()) - 1) / int64(pagination.GetPageSize()),
		},
	})
}
```

### 3. æ·»åŠ è·¯ç”±

```go
// routes/routes.go
messages.GET("/list", handlers.GetMessagesWithPagination) // åˆ†é¡µè·å–ç•™è¨€
```

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

```bash
# è·å–ç¬¬1é¡µï¼Œæ¯é¡µ10æ¡
curl "http://localhost:8080/api/messages/list?page=1&page_size=10"

# è·å–ç¬¬2é¡µï¼Œæ¯é¡µ5æ¡
curl "http://localhost:8080/api/messages/list?page=2&page_size=5"
```

### å“åº”ç¤ºä¾‹

```json
{
  "data": [...],
  "pagination": {
    "page": 1,
    "page_size": 10,
    "total": 25,
    "pages": 3
  }
}
```

---

## ğŸ“š ç›¸å…³ç¬”è®°

- [[ç•™è¨€ç³»ç»Ÿé¡¹ç›®å®æˆ˜]] - ä¸»é¡¹ç›®
- [[æœç´¢åŠŸèƒ½å®ç°]] - æœç´¢åŠŸèƒ½

---

#Go #GORM #åˆ†é¡µ #åç«¯å¼€å‘
