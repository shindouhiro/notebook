# Go æœç´¢åŠŸèƒ½å®ç°

> ğŸ”— **å…³è”ç¬”è®°**ï¼š[[ç•™è¨€ç³»ç»Ÿé¡¹ç›®å®æˆ˜]]
> ğŸ“… **åˆ›å»ºæ—¶é—´**ï¼š2024-12-24

---

## ğŸ“– æ¦‚è¿°

ä¸ºç•™è¨€ç³»ç»Ÿæ·»åŠ æœç´¢åŠŸèƒ½ï¼Œæ”¯æŒæŒ‰å…³é”®è¯ã€ä½œè€…ã€æ—¶é—´èŒƒå›´ç­‰æ¡ä»¶æœç´¢ç•™è¨€ã€‚

---

## ğŸ› ï¸ å®ç°æ­¥éª¤

### 1. å®šä¹‰æœç´¢å‚æ•°ç»“æ„

```go
// handlers/search.go
package handlers

import "time"

// SearchParams æœç´¢å‚æ•°
type SearchParams struct {
	Keyword   string     `form:"keyword"`    // å…³é”®è¯ (æœç´¢å†…å®¹å’Œä½œè€…)
	Author    string     `form:"author"`     // ä½œè€…å
	StartDate *time.Time `form:"start_date"` // å¼€å§‹æ—¥æœŸ
	EndDate   *time.Time `form:"end_date"`   // ç»“æŸæ—¥æœŸ
	Page      int        `form:"page"`       // é¡µç 
	PageSize  int        `form:"page_size"`  // æ¯é¡µæ•°é‡
}
```

### 2. æœç´¢å¤„ç†å™¨

```go
// handlers/message.go

// SearchMessages æœç´¢ç•™è¨€
func SearchMessages(c *gin.Context) {
	var params SearchParams
	var messages []models.Message
	var total int64
	
	// ç»‘å®šæœç´¢å‚æ•°
	if err := c.ShouldBindQuery(&params); err != nil {
		c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
		return
	}
	
	// æ„å»ºæŸ¥è¯¢
	query := config.DB.Model(&models.Message{})
	
	// å…³é”®è¯æœç´¢ (æ¨¡ç³ŠåŒ¹é…å†…å®¹å’Œä½œè€…)
	if params.Keyword != "" {
		keyword := "%" + params.Keyword + "%"
		query = query.Where("content LIKE ? OR author LIKE ?", keyword, keyword)
	}
	
	// ä½œè€…ç²¾ç¡®åŒ¹é…
	if params.Author != "" {
		query = query.Where("author = ?", params.Author)
	}
	
	// æ—¶é—´èŒƒå›´
	if params.StartDate != nil {
		query = query.Where("created_at >= ?", params.StartDate)
	}
	if params.EndDate != nil {
		query = query.Where("created_at <= ?", params.EndDate)
	}
	
	// è·å–æ€»æ•°
	query.Count(&total)
	
	// åˆ†é¡µ
	page := params.Page
	if page <= 0 {
		page = 1
	}
	pageSize := params.PageSize
	if pageSize <= 0 {
		pageSize = 10
	}
	offset := (page - 1) * pageSize
	
	// æ‰§è¡ŒæŸ¥è¯¢
	result := query.
		Order("created_at desc").
		Offset(offset).
		Limit(pageSize).
		Find(&messages)
	
	if result.Error != nil {
		c.JSON(http.StatusInternalServerError, gin.H{"error": "æœç´¢å¤±è´¥"})
		return
	}
	
	c.JSON(http.StatusOK, gin.H{
		"data":  messages,
		"total": total,
		"page":  page,
	})
}
```

### 3. æ·»åŠ è·¯ç”±

```go
// routes/routes.go
messages.GET("/search", handlers.SearchMessages) // æœç´¢ç•™è¨€
```

---

## ğŸ” é«˜çº§æœç´¢ - å…¨æ–‡ç´¢å¼•

å¯¹äºå¤§æ•°æ®é‡ï¼Œå¯ä»¥ä½¿ç”¨ MySQL å…¨æ–‡ç´¢å¼•ï¼š

```sql
-- æ·»åŠ å…¨æ–‡ç´¢å¼•
ALTER TABLE messages ADD FULLTEXT INDEX ft_content (content);
ALTER TABLE messages ADD FULLTEXT INDEX ft_author (author);
```

```go
// ä½¿ç”¨å…¨æ–‡æœç´¢
query = query.Where("MATCH(content) AGAINST(? IN BOOLEAN MODE)", params.Keyword)
```

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

```bash
# æŒ‰å…³é”®è¯æœç´¢
curl "http://localhost:8080/api/messages/search?keyword=æµ‹è¯•"

# æŒ‰ä½œè€…æœç´¢
curl "http://localhost:8080/api/messages/search?author=å¼ ä¸‰"

# ç»„åˆæœç´¢
curl "http://localhost:8080/api/messages/search?keyword=ç•™è¨€&author=å¼ ä¸‰&page=1&page_size=5"

# æ—¶é—´èŒƒå›´æœç´¢
curl "http://localhost:8080/api/messages/search?start_date=2024-01-01&end_date=2024-12-31"
```

---

## ğŸ“š ç›¸å…³ç¬”è®°

- [[ç•™è¨€ç³»ç»Ÿé¡¹ç›®å®æˆ˜]] - ä¸»é¡¹ç›®
- [[åˆ†é¡µæŸ¥è¯¢å®ç°]] - åˆ†é¡µåŠŸèƒ½

---

#Go #GORM #æœç´¢ #åç«¯å¼€å‘
